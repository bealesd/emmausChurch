@using Emmaus.Helper;
@{
    var title = (string)ViewData["Title"];
    var rota = (RotaDictionary)ViewData["rota"];
    var names = ((List<string>)ViewData["names"]);
}

<div class="mainWrapper">

    <div class="title">
        Rota Management
    </div>

    <!--#region table  -->
    <div class="rotaManagement">

        <table style="">
            <tr>
                <th class="table-header">Date</th>

                @if (names.Count > 0)
                {
                    @foreach (var name in names)
                    {
                        <th class="table-header">@name.JoinedCapitalizedNameToSpaceSeparatedName()</th>
                    }
                }
                else
                {
                    <th class="table-header">Name</th>
                }

            </tr>

            @if (rota.DateNameJobListPairs.Count > 0)
            {
                @foreach (var date in rota.DateNameJobListPairs.Keys)
                {
                    <tr>
                        <td class="field">@date.ToFriendly()</td>
                        @foreach (string name in names)
                        {

                            <td class="field">
                                <p hidden>Remove @name.JoinedCapitalizedNameToSpaceSeparatedName() from rota on: @date.ToFriendly()</p>
                                @{
                                    foreach (var role in @rota.DateNameJobListPairs[date].KeyValues[name])
                                    {
                                        if (title == "Band Rota")
                                        {
                                            <a onclick="ConfirmDelete(this)" asp-action="DeleteFromRotaBand" asp-route-year="@date.Year" asp-route-month="@date.Month" asp-route-day="@date.Day" asp-route-name="@name" asp-route-role="@role">
                                                @role
                                            </a>
                                        }
                                        else if (title == "Projection Rota")
                                        {
                                            <a onclick="ConfirmDelete(this)" asp-action="DeleteFromRotaProjection" asp-route-year="@date.Year" asp-route-month="@date.Month" asp-route-day="@date.Day" asp-route-name="@name" asp-route-role="@role">
                                                @role
                                            </a>
                                        }
                                        else if (title == "Youth Rota")
                                        {
                                            <a onclick="ConfirmDelete(this)" asp-action="DeleteFromRotaYouthClub" asp-route-year="@date.Year" asp-route-month="@date.Month" asp-route-day="@date.Day" asp-route-name="@name" asp-route-role="@role">
                                                @role
                                            </a>
                                        }
                                    }
                                }
                            </td>
                        }
                    </tr>
                }
            }

        </table>

    </div>
</div>

<script>
    function ConfirmDelete(self) {
        let message = self.parentElement.getElementsByTagName("p")[0].innerHTML;
        if (confirm(message)) {
            return;
        }
        event.preventDefault();
    }
</script>